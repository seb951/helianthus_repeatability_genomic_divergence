###This file will walk you through the different steps and requirements of the analysis#
###You may also look at the different scripts to see more details.

### Sebastien Renaut - February 2012 ###
### sebastien.renaut@gmail.com ###

###
###required directories
###
#You need a main directory were are your files are and analysis will be done (here this is /media/seb_1TB/transposon)
#In this directory you'll have different subdirectories
#data/ : contains the data as _1.fq/_2.fq files or sub directories which contain several fastq.gz (eg. : "Goblinvalley_AGTCAA_L006_R1_001.fastq.gz", where 001 indicates it is the first subfile, and R1 means it is pair 1 or 2.) files which need to be unzipped and concatenated.
#results/ : will contain the main result table
#alignments/: will contain the alignments generated by bwa.
#Rcode/ : contains the Rcode required for analysis 
#reference/ : contains the reference fasta file (here HA412_trinity_noAltSplice_400bpmin.fa) and a list of the .fq sequences ("hybrid_species") in the proper format ("path\to\sequence"	"species"	"ill"	"sanger").
#mpileup/ : will contain temporatory files generated by mpileup. 
#mpileup/cmd : will contain temporatory files generated by mpileup.

###
###required files & programs
###
#Unix based machine (Mac or Linux), >2-core machine.
#reference transcriptome (.fasta file and split file), sequence files (.fastq), list of 
#R (â‰¥ 2.15.0, http://www.r-project.org/)
#bwa (http://bio-bwa.sourceforge.net/)
#samtools (http://samtools.sourceforge.net/)
#working copy of java (http://www.java.com/en/download/index.jsp)
#trimmomatic (http://www.usadellab.org/cms/index.php?page=trimmomatic)
#vcfutils.pl (from samtools, but copy it to your Rcode directory)

###
### Running analysis
###


###Step 1.
bwa_samtools.R
Align using bwa and generated a bam files using samtools
Make sure you have the proper exilis and bolanderi samples. Some samples are on the zoology cluster

###Step 2. 
mpileup_v6_species.R
Generates a large SNP table using mpileup and bcftools using the information from all samples for the first 1000 genes.
DO NOT USE THE 454 SAMPLES ANYMORE!!! REMOVE THE ONES BASED ON ISLANDS OF SPECIATION PAPER!

###Step 3. 
NJtree.R
This generates a nexus file of 12600 snps for all individuals. Load it into splitstree to see what the patterns look like. Based on this, you can classify the _WEST and _EAST samples for exilis and bolanderi in the "all_species_nov2012_cleaned.txt" file. . 

###Step 4
mpileup_2013_03_20.R
run this per species pair for all genes. 
Takes a lot of time...

###step 5. 
snp_parser_6species_exi_bol_arg_ann_pet_deb.R
run this per species pair for all genes. 
Takes a lot of time...

###step 6. 
cor123.R
run correlation analysis for correlation per gene per snp per genomic position..
also plot the bar graph per chromosome

###step 7. 
dnds.R and dnds_pergenomicposition.R
calculate dnds per gene and then calculate per genomic position

###step 8. 
lnRH.R
calculated the lnrh statistics for different species pairs.


###SANDBOX


###Step 4.
PAML_consensus_calling_from_SNPdata.R
Takes in the "*_comp4" files to generate "dnds_*" files.


###Step 5. 
island.R
Takes in the "*_comp4" and "dnds_*" files. , then adds the map information to each locus. Generates the "*_fst_map" files
Then calculates the clustering of divergent sites and generates six "*_cluster2" files. 


###Step 6
Moran.R
takes in the "*_fst_map" files to calculate measures of spatial autocor per chromosome to generate "*_moran" files.

###Step 7
plotting.R
takes in the "*_cluster2" files and plot histogram, number of islands, etc...
 
